<html lang=en>

<head>
        <title>MQTT over WebSocket test</title>
        <meta charset="UTF-8">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
        </script>
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>

        <script type="text/javascript">
                var mqtt;

                $(function () {
                        mqtt = new Paho.MQTT.Client("localhost", 9090, "cli01");
                        console.log("conncting");

                        var options = {
                                timeout: 60,
                                onSuccess: onConnect,
                                onFailure: onFailure,
                        };

                        mqtt.onMessageArrived = onMessageArrived;
                        mqtt.connect(options);
                });

                function onConnect() {
                        console.log("on Connect");
                        mqtt.subscribe("isyjp/tp01");
                }

                function onMessageArrived(msg) {
                        console.log("on Arrived");
                        console.log(msg.payloadString)
                        $('#message').text(msg.payloadString);
                }

                function onFailure() {}

                function ledon() {
                        message = new Paho.MQTT.Message("on");
                        message.destinationName = "isyjp/gpio21";
                        mqtt.send(message);
                        console.log("led on.");
                }

                function ledoff() {
                        message = new Paho.MQTT.Message("off");
                        message.destinationName = "isyjp/gpio21";
                        mqtt.send(message);
                        console.log("led off.");
                }
        </script>
</head>

<body>
        websocket test <br />
        <p><button type="button" onclick="ledon()">LED On</button></p>
        <p><button type="button" onclick="ledoff()">LED Off</button></p>
        <p>
                <div id="message">Message</div>
        </p>
</body>

</html>